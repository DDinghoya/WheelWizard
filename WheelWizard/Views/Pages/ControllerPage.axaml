<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignHeight="450" d:DesignWidth="800"
             x:Class="WheelWizard.Views.Pages.ControllerPage"
             xmlns:lang="clr-namespace:WheelWizard.Resources.Languages"
             xmlns:components="clr-namespace:WheelWizard.Views.Components"
             xmlns:controllers="clr-namespace:WheelWizard.ControllerSettings"
             xmlns:dolphin="clr-namespace:WheelWizard.Features.Dolphin"
             xmlns:converters="clr-namespace:WheelWizard.Views.Converters">
    <UserControl.Resources>
        <converters:BoolToActiveBrushConverter x:Key="BoolToActiveBrushConverter" />
        <converters:BoolToActiveTextConverter x:Key="BoolToActiveTextConverter" />
        <converters:BoolToActiveTextBrushConverter x:Key="BoolToActiveTextBrushConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </UserControl.Resources>
    <Grid>
        <ScrollViewer>
            <StackPanel Margin="20" Spacing="20">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                    <TextBlock Grid.Column="0" Text="Controller Settings" Classes="PageTitle" />
                    <Button Grid.Column="1" 
                            x:Name="TestControllerButton"
                            Content="Test Controllers" 
                            Click="TestControllerButton_Click"
                            Margin="0,0,10,0" />
                    <Button Grid.Column="2" 
                            x:Name="DiagnosticButton"
                            Content="Run Diagnostics" 
                            Click="DiagnosticButton_Click"
                            Margin="0,0,10,0" />
                    <Button Grid.Column="3" 
                            x:Name="RefreshButton"
                            Content="Refresh" 
                            Click="RefreshButton_Click" />
                </Grid>
                
                <!-- Connected Controllers Section -->
                <Border Background="{StaticResource Neutral800}" CornerRadius="{StaticResource GlobalCornerRadius}" Padding="20">
                    <StackPanel Spacing="15">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Text="Connected Controllers" Classes="SectionTitle" />
                            <TextBlock Grid.Column="1" 
                                       x:Name="ControllerCountText" 
                                       Text="0 connected" 
                                       Classes="TinyText" 
                                       Foreground="{StaticResource Neutral400}" 
                                       VerticalAlignment="Center" />
                        </Grid>
                        
                        <ItemsControl x:Name="ControllersList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="controllers:ControllerInfo">
                                    <Border Background="{StaticResource Neutral700}" 
                                            CornerRadius="{StaticResource GlobalCornerRadius}" 
                                            Padding="20" 
                                            Margin="0,0,0,15">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <!-- Controller Icon -->
                                            <Border Grid.Column="0" 
                                                    Background="{StaticResource Primary500}" 
                                                    CornerRadius="8" 
                                                    Width="48" 
                                                    Height="48" 
                                                    Margin="0,0,20,0">
                                                <PathIcon Data="{StaticResource Grip}" 
                                                          Width="24" 
                                                          Height="24" 
                                                          Foreground="White" />
                                            </Border>
                                            
                                            <!-- Controller Info -->
                                            <StackPanel Grid.Column="1" Spacing="8" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" Classes="BodyText" FontWeight="Bold" />
                                                <StackPanel Orientation="Horizontal" Spacing="15">
                                                    <Border Background="{StaticResource Primary100}" 
                                                            CornerRadius="12" 
                                                            Padding="8,4">
                                                        <TextBlock Text="Connected" 
                                                                   Classes="TinyText" 
                                                                   Foreground="{StaticResource Primary700}" 
                                                                   FontWeight="Medium" />
                                                    </Border>
                                                    <TextBlock Text="{Binding ControllerType}" 
                                                               Classes="TinyText" 
                                                               Foreground="{StaticResource Neutral400}" />
                                                    <TextBlock Text="{Binding Index, StringFormat='Player {0}'}" 
                                                               Classes="TinyText" 
                                                               Foreground="{StaticResource Neutral400}" />
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- Status Indicator -->
                                            <Border Grid.Column="2" 
                                                    Background="{StaticResource Primary500}" 
                                                    CornerRadius="6" 
                                                    Width="12" 
                                                    Height="12" 
                                                    VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <components:EmptyPageInfo x:Name="NoControllersInfo" 
                                                  IsVisible="False"
                                                  IconData="{StaticResource Grip}"
                                                  Title="No Controllers Detected"
                                                  BodyText="Connect a controller and click Refresh to detect it. Supports Xbox, PlayStation, Nintendo, and generic USB controllers." />
                    </StackPanel>
                </Border>

                <!-- Controller Profiles Section -->
                <Border Background="{StaticResource Neutral800}" CornerRadius="{StaticResource GlobalCornerRadius}" Padding="20">
                    <StackPanel Spacing="20">
                        <Grid ColumnDefinitions="*,Auto,Auto">
                            <TextBlock Grid.Column="0" Text="Controller Profiles" Classes="SectionTitle" />
                            <Button Grid.Column="1" 
                                    x:Name="CreateProfileButton"
                                    Content="Create Profile" 
                                    Click="CreateProfileButton_Click"
                                    Margin="0,0,10,0" />
                            <Button Grid.Column="2" 
                                    x:Name="ImportProfileButton"
                                    Content="Import Profile" 
                                    Click="ImportProfileButton_Click" />
                        </Grid>
                        
                        <TextBlock Text="Create and manage controller profiles for Mario Kart Wii. Profiles are automatically applied to Dolphin's controller configuration." 
                                   Classes="BodyText" 
                                   TextWrapping="Wrap" 
                                   Foreground="{StaticResource Neutral400}" />

                        <ItemsControl x:Name="ProfilesList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="dolphin:DolphinControllerProfile">
                                    <Border Background="{StaticResource Neutral700}" 
                                            CornerRadius="{StaticResource GlobalCornerRadius}" 
                                            Padding="20" 
                                            Margin="0,0,0,15">
                                        <Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                                            <!-- Profile Icon -->
                                            <Border Grid.Column="0" 
                                                    Background="{StaticResource Primary500}" 
                                                    CornerRadius="8" 
                                                    Width="48" 
                                                    Height="48" 
                                                    Margin="0,0,20,0">
                                                <PathIcon Data="{StaticResource Grip}" 
                                                          Width="24" 
                                                          Height="24" 
                                                          Foreground="White" />
                                            </Border>
                                            
                                            <!-- Profile Info -->
                                            <StackPanel Grid.Column="1" Spacing="8" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" Classes="BodyText" FontWeight="Bold" />
                                                <StackPanel Orientation="Horizontal" Spacing="15">
                                                    <Border Background="{Binding IsActive, Converter={StaticResource BoolToActiveBrushConverter}}" 
                                                            CornerRadius="12" 
                                                            Padding="8,4">
                                                        <TextBlock Text="{Binding IsActive, Converter={StaticResource BoolToActiveTextConverter}}" 
                                                                   Classes="TinyText" 
                                                                   Foreground="{Binding IsActive, Converter={StaticResource BoolToActiveTextBrushConverter}}" 
                                                                   FontWeight="Medium" />
                                                    </Border>
                                                    <TextBlock Text="{Binding ControllerType}" 
                                                               Classes="TinyText" 
                                                               Foreground="{StaticResource Neutral400}" />
                                                    <TextBlock Text="{Binding CreatedAt, StringFormat='Created {0:MMM dd}'}" 
                                                               Classes="TinyText" 
                                                               Foreground="{StaticResource Neutral400}" />
                                                </StackPanel>
                                            </StackPanel>
                                            
                                            <!-- Action Buttons -->
                                            <Button Grid.Column="2" 
                                                    Content="Activate" 
                                                    Click="ActivateProfileButton_Click"
                                                    CommandParameter="{Binding Name}"
                                                    IsVisible="{Binding IsActive, Converter={StaticResource InverseBooleanConverter}}"
                                                    Margin="0,0,10,0" />
                                            <Button Grid.Column="3" 
                                                    Content="Edit" 
                                                    Click="EditProfileButton_Click"
                                                    CommandParameter="{Binding Name}"
                                                    Margin="0,0,10,0" />
                                            <Button Grid.Column="4" 
                                                    Content="Delete" 
                                                    Click="DeleteProfileButton_Click"
                                                    CommandParameter="{Binding Name}" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <components:EmptyPageInfo x:Name="NoProfilesInfo" 
                                                  IsVisible="False"
                                                  IconData="{StaticResource Grip}"
                                                  Title="No Controller Profiles"
                                                  BodyText="Create your first controller profile to get started. Profiles make it easy to switch between different controller layouts for Mario Kart Wii." />
                    </StackPanel>
                </Border>

                <!-- Quick Setup Section -->
                <Border Background="{StaticResource Neutral800}" CornerRadius="{StaticResource GlobalCornerRadius}" Padding="20">
                    <StackPanel Spacing="20">
                        <TextBlock Text="Quick Setup" Classes="SectionTitle" />
                        <TextBlock Text="Get started quickly with recommended controller configurations for Mario Kart Wii." 
                                   Classes="BodyText" 
                                   TextWrapping="Wrap" 
                                   Foreground="{StaticResource Neutral400}" />

                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" Margin="0,10,0,0">
                            <!-- GameCube Controller Setup -->
                            <Border Grid.Column="0" Grid.Row="0" 
                                    Background="{StaticResource Neutral700}" 
                                    CornerRadius="{StaticResource GlobalCornerRadius}" 
                                    Padding="20" 
                                    Margin="0,0,10,10">
                                <StackPanel Spacing="15">
                                    <Grid ColumnDefinitions="Auto,*">
                                        <Border Grid.Column="0" 
                                                Background="{StaticResource Primary500}" 
                                                CornerRadius="6" 
                                                Width="32" 
                                                Height="32" 
                                                Margin="0,0,15,0">
                                            <PathIcon Data="{StaticResource Grip}" 
                                                      Width="16" 
                                                      Height="16" 
                                                      Foreground="White" />
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="GameCube Controller" Classes="BodyText" FontWeight="Bold" />
                                            <TextBlock Text="Recommended for modern controllers" 
                                                       Classes="TinyText" 
                                                       Foreground="{StaticResource Neutral400}" />
                                        </StackPanel>
                                    </Grid>
                                    
                                    <TextBlock Text="Uses standard GameCube controller layout. Perfect for Xbox, PlayStation, and generic USB controllers." 
                                               Classes="TinyText" 
                                               TextWrapping="Wrap" 
                                               Foreground="{StaticResource Neutral400}" />
                                    
                                    <Button Content="Setup GameCube Profile" 
                                            Click="SetupGameCubeProfileButton_Click"
                                            HorizontalAlignment="Stretch" />
                                </StackPanel>
                            </Border>

                            <!-- Wii Remote Setup -->
                            <Border Grid.Column="1" Grid.Row="0" 
                                    Background="{StaticResource Neutral700}" 
                                    CornerRadius="{StaticResource GlobalCornerRadius}" 
                                    Padding="20" 
                                    Margin="10,0,0,10">
                                <StackPanel Spacing="15">
                                    <Grid ColumnDefinitions="Auto,*">
                                        <Border Grid.Column="0" 
                                                Background="{StaticResource Secondary500}" 
                                                CornerRadius="6" 
                                                Width="32" 
                                                Height="32" 
                                                Margin="0,0,15,0">
                                            <PathIcon Data="{StaticResource Grip}" 
                                                      Width="16" 
                                                      Height="16" 
                                                      Foreground="White" />
                                        </Border>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="Wii Remote + Nunchuk" Classes="BodyText" FontWeight="Bold" />
                                            <TextBlock Text="Classic Mario Kart Wii experience" 
                                                       Classes="TinyText" 
                                                       Foreground="{StaticResource Neutral400}" />
                                        </StackPanel>
                                    </Grid>
                                    
                                    <TextBlock Text="Emulates Wii Remote with Nunchuk using your controller. Includes motion controls for authentic gameplay." 
                                               Classes="TinyText" 
                                               TextWrapping="Wrap" 
                                               Foreground="{StaticResource Neutral400}" />
                                    
                                    <Button Content="Setup Wii Remote Profile" 
                                            Click="SetupWiiRemoteProfileButton_Click"
                                            HorizontalAlignment="Stretch" />
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Testing Section (Collapsible) -->
                <Border Background="{StaticResource Neutral800}" 
                        CornerRadius="{StaticResource GlobalCornerRadius}" 
                        Padding="20"
                        x:Name="TestingSection"
                        IsVisible="False">
                    <StackPanel Spacing="20">
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBlock Grid.Column="0" Text="Controller Testing" Classes="SectionTitle" />
                            <Button Grid.Column="1" 
                                    x:Name="HideTestingButton"
                                    Content="Hide Testing" 
                                    Click="HideTestingButton_Click" />
                        </Grid>
                        <TextBlock Text="Test your controllers by pressing buttons and moving sticks. Real-time feedback shows which inputs are active." 
                                   Classes="BodyText" 
                                   TextWrapping="Wrap" 
                                   Foreground="{StaticResource Neutral400}" />
                        
                        <ItemsControl x:Name="ControllerTestList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="controllers:ControllerInfo">
                                    <Border Background="{StaticResource Neutral700}" 
                                            CornerRadius="{StaticResource GlobalCornerRadius}" 
                                            Padding="25" 
                                            Margin="0,0,0,20">
                                        <StackPanel Spacing="20">
                                            <!-- Controller Header -->
                                            <Grid ColumnDefinitions="Auto,*">
                                                <Border Grid.Column="0" 
                                                        Background="{StaticResource Primary500}" 
                                                        CornerRadius="6" 
                                                        Width="32" 
                                                        Height="32" 
                                                        Margin="0,0,15,0">
                                                    <PathIcon Data="{StaticResource Grip}" 
                                                              Width="16" 
                                                              Height="16" 
                                                              Foreground="White" />
                                                </Border>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Name}" Classes="BodyText" FontWeight="Bold" />
                                                    <TextBlock Text="{Binding Index, StringFormat='Player {0}'}" 
                                                               Classes="TinyText" 
                                                               Foreground="{StaticResource Neutral400}" />
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- Simplified Controller Display -->
                                            <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto">
                                                <!-- Face Buttons -->
                                                <StackPanel Grid.Column="0" Grid.Row="0" Spacing="8" HorizontalAlignment="Center">
                                                    <TextBlock Text="Face Buttons" Classes="TinyText" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <Border x:Name="AButton" Background="{StaticResource Neutral600}" Width="20" Height="20" CornerRadius="10">
                                                            <TextBlock Text="A" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                                                        </Border>
                                                        <Border x:Name="BButton" Background="{StaticResource Neutral600}" Width="20" Height="20" CornerRadius="10">
                                                            <TextBlock Text="B" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                                                        </Border>
                                                        <Border x:Name="XButton" Background="{StaticResource Neutral600}" Width="20" Height="20" CornerRadius="10">
                                                            <TextBlock Text="X" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                                                        </Border>
                                                        <Border x:Name="YButton" Background="{StaticResource Neutral600}" Width="20" Height="20" CornerRadius="10">
                                                            <TextBlock Text="Y" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" />
                                                        </Border>
                                                    </StackPanel>
                                                </StackPanel>
                                                
                                                <!-- D-Pad -->
                                                <StackPanel Grid.Column="1" Grid.Row="0" Spacing="8" HorizontalAlignment="Center">
                                                    <TextBlock Text="D-Pad" Classes="TinyText" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    <Grid Width="60" Height="60">
                                                        <Rectangle Fill="{StaticResource Neutral600}" Width="40" Height="15" VerticalAlignment="Center" />
                                                        <Rectangle Fill="{StaticResource Neutral600}" Width="15" Height="40" HorizontalAlignment="Center" />
                                                        <Border x:Name="DPadUp" Background="{StaticResource Neutral600}" Width="12" Height="12" 
                                                                VerticalAlignment="Top" HorizontalAlignment="Center" CornerRadius="2" />
                                                        <Border x:Name="DPadDown" Background="{StaticResource Neutral600}" Width="12" Height="12" 
                                                                VerticalAlignment="Bottom" HorizontalAlignment="Center" CornerRadius="2" />
                                                        <Border x:Name="DPadLeft" Background="{StaticResource Neutral600}" Width="12" Height="12" 
                                                                VerticalAlignment="Center" HorizontalAlignment="Left" CornerRadius="2" />
                                                        <Border x:Name="DPadRight" Background="{StaticResource Neutral600}" Width="12" Height="12" 
                                                                VerticalAlignment="Center" HorizontalAlignment="Right" CornerRadius="2" />
                                                    </Grid>
                                                </StackPanel>
                                                
                                                <!-- Triggers & Shoulders -->
                                                <StackPanel Grid.Column="2" Grid.Row="0" Spacing="8" HorizontalAlignment="Center">
                                                    <TextBlock Text="Triggers" Classes="TinyText" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    <StackPanel Spacing="5">
                                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                                            <Border x:Name="LeftShoulder" Background="{StaticResource Neutral600}" Width="25" Height="15" CornerRadius="3">
                                                                <TextBlock Text="LB" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                            </Border>
                                                            <Border x:Name="RightShoulder" Background="{StaticResource Neutral600}" Width="25" Height="15" CornerRadius="3">
                                                                <TextBlock Text="RB" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                            </Border>
                                                        </StackPanel>
                                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                                            <Border Background="{StaticResource Neutral600}" Width="25" Height="6" CornerRadius="3">
                                                                <Border x:Name="LeftTriggerBar" Background="{StaticResource Primary400}" Width="0" Height="6" CornerRadius="3" HorizontalAlignment="Left" />
                                                            </Border>
                                                            <Border Background="{StaticResource Neutral600}" Width="25" Height="6" CornerRadius="3">
                                                                <Border x:Name="RightTriggerBar" Background="{StaticResource Primary400}" Width="0" Height="6" CornerRadius="3" HorizontalAlignment="Left" />
                                                            </Border>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </StackPanel>
                                                
                                                <!-- Analog Sticks -->
                                                <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2" Spacing="8" HorizontalAlignment="Center" Margin="0,15,0,0">
                                                    <TextBlock Text="Analog Sticks" Classes="TinyText" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    <StackPanel Orientation="Horizontal" Spacing="20">
                                                        <StackPanel Spacing="5">
                                                            <Border Background="{StaticResource Neutral600}" Width="40" Height="40" CornerRadius="20">
                                                                <Border x:Name="LeftStickIndicator" Background="{StaticResource Primary400}" Width="12" Height="12" CornerRadius="6" />
                                                            </Border>
                                                            <TextBlock x:Name="LeftStickText" Text="(0.0, 0.0)" Classes="TinyText" HorizontalAlignment="Center" Foreground="{StaticResource Neutral400}" />
                                                        </StackPanel>
                                                        <StackPanel Spacing="5">
                                                            <Border Background="{StaticResource Neutral600}" Width="40" Height="40" CornerRadius="20">
                                                                <Border x:Name="RightStickIndicator" Background="{StaticResource Primary400}" Width="12" Height="12" CornerRadius="6" />
                                                            </Border>
                                                            <TextBlock x:Name="RightStickText" Text="(0.0, 0.0)" Classes="TinyText" HorizontalAlignment="Center" Foreground="{StaticResource Neutral400}" />
                                                        </StackPanel>
                                                    </StackPanel>
                                                </StackPanel>
                                                
                                                <!-- Menu Buttons -->
                                                <StackPanel Grid.Column="2" Grid.Row="1" Spacing="8" HorizontalAlignment="Center" Margin="0,15,0,0">
                                                    <TextBlock Text="Menu" Classes="TinyText" FontWeight="Bold" HorizontalAlignment="Center" />
                                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                                        <Border x:Name="BackButton" Background="{StaticResource Neutral600}" Width="25" Height="15" CornerRadius="3">
                                                            <TextBlock Text="◀◀" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                        </Border>
                                                        <Border x:Name="StartButton" Background="{StaticResource Neutral600}" Width="25" Height="15" CornerRadius="3">
                                                            <TextBlock Text="☰" Classes="TinyText" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                        </Border>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl> 